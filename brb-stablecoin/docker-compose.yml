services:
  solana-dev:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: brb-stablecoin-dev
    volumes:
      # Mount project directory
      - .:/workspace
      # Persist Solana config and keypairs
      - solana-config:/home/solana/.config/solana
      # Persist Cargo cache for faster rebuilds
      - cargo-cache:/home/solana/.cargo/registry
      - cargo-git:/home/solana/.cargo/git
      # Persist Anchor cache
      - anchor-cache:/home/solana/.cache/anchor
    working_dir: /workspace
    environment:
      - RUST_BACKTRACE=1
      - ANCHOR_WALLET=/home/solana/.config/solana/id.json
    stdin_open: true
    tty: true
    entrypoint: ["/bin/bash", "-c"]
    command:
      - |
        # Set Solana config on first run if not already set
        if [ ! -f /home/solana/.config/solana/cli/config.yml ]; then
          solana config set --url devnet > /dev/null 2>&1 || true
        fi
        exec /bin/bash
    ports:
      - "8899:8899"

volumes:
  solana-config:
  cargo-cache:
  cargo-git:
  anchor-cache:
